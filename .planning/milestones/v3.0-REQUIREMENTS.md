# Requirements Archive: v3.0 Platform Admin Restructure

**Archived:** 2026-02-13
**Status:** SHIPPED

This is the archived requirements specification for v3.0.

---

## Milestone Requirements

### Schema & Data Migration

- [x] **SCHEMA-01**: Migration makes role_entity_id and role_entity_type nullable in user_roles table with zero downtime and reversibility
- [x] **SCHEMA-02**: Partial unique index prevents duplicate platform_admin rows per user (handles NULL correctly)
- [x] **SCHEMA-03**: Revoking platform_admin role immediately blocks access via deleted_at filtering in queries

### Access Control Integration

- [x] **ACCESS-01**: resolveAccessContext() finds platform_admin in user_roles table and returns isPlatformAdmin: true (119+ downstream consumers unchanged)
- [x] **ACCESS-02**: identity-service creates and deletes platform_admin via POST/DELETE /v2/user-roles with nullable entity fields
- [x] **ACCESS-03**: All 13 frontend files checking isPlatformAdmin continue working without modification

### Audit & Cleanup

- [x] **AUDIT-01**: Platform admin grant/revoke publishes user_role.created/deleted events via RabbitMQ
- [x] **AUDIT-02**: Synthetic platform organization (type='platform') and related memberships are deleted after migration

## Future Requirements

- **DIFF-2**: Role-entity type validation — DB check constraint preventing platform_admin with entity_id (v3.1)
- **DIFF-3**: Migration rollback plan — documented/tested rollback SQL (v3.1)
- **DIFF-4**: Service-level abstraction — shared assignSystemRole() helper (v4+)
- **DIFF-5**: Admin activity dashboard — frontend audit trail view (v4+)

## Out of Scope

- Restructuring company_admin/hiring_manager roles — legitimately org-scoped, stay in memberships
- Fine-grained permissions system — future milestone
- Role UI/admin panel redesign — just the data model change
- Runtime role hierarchy engine — over-engineering for current needs

## Traceability

| REQ | Phase | Status |
|-----|-------|--------|
| SCHEMA-01 | Phase 4 | Complete |
| SCHEMA-02 | Phase 4 | Complete |
| SCHEMA-03 | Phase 4 | Complete |
| ACCESS-01 | Phase 5 | Complete |
| ACCESS-02 | Phase 5 | Complete |
| ACCESS-03 | Phase 5 | Complete |
| AUDIT-01 | Phase 5 | Complete |
| AUDIT-02 | Phase 6 | Complete |

---

## Milestone Summary

**Shipped:** 8 of 8 requirements
**Adjusted:** None — all requirements shipped as originally specified
**Dropped:** None

---
*Archived: 2026-02-13 as part of v3.0 milestone completion*
