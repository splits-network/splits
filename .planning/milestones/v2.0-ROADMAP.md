# Milestone v2.0: Global Search

**Status:** SHIPPED 2026-02-13
**Phases:** 1-3 (Phase 4 dropped)
**Total Plans:** 7

## Overview

Build full-stack global search from database infrastructure through API to real-time UI. Deliver a Google-like search experience across all entities (candidates, jobs, companies, recruiters, applications, placements) with role-based access control. The journey starts with a dedicated search schema and trigger-based sync, then builds API endpoints, real-time typeahead in the portal header, and finally a full search results page.

## Phases

### Phase 1: Search Infrastructure

**Goal**: Dedicated search schema operational with near-real-time sync from all entity tables
**Depends on**: Nothing (first phase)
**Requirements**: INFRA-01, INFRA-02, INFRA-03, INFRA-04, INFRA-05, INFRA-06, INFRA-07, INFRA-08, INFRA-09
**Plans**: 3 plans

Plans:
- [x] 01-01-PLAN.md — Foundation: fix recruiters ILIKE->tsvector, create search schema + search_index table + GIN index
- [x] 01-02-PLAN.md — Core entity triggers: candidates, jobs, companies sync to search_index
- [x] 01-03-PLAN.md — Relational entity triggers: recruiters, applications, placements, recruiter_candidates sync to search_index

### Phase 2: Search API

**Goal**: Backend search endpoints ready with access control and input validation
**Depends on**: Phase 1
**Requirements**: API-01, API-02, API-03
**Plans**: 2 plans

Plans:
- [x] 02-01-PLAN.md — Create search-service: repository, service, types, and route handler with access control and validation
- [x] 02-02-PLAN.md — Wire search-service into API gateway with proxy routes and service registration

### Phase 3: Typeahead Search

**Goal**: Real-time search bar in portal header with keyboard navigation and result navigation
**Depends on**: Phase 2
**Requirements**: TYPE-01, TYPE-02, TYPE-03, TYPE-04, TYPE-05, TYPE-06, TYPE-07, TYPE-08, INT-01, INT-02
**Plans**: 2 plans

Plans:
- [x] 03-01-PLAN.md — Search hook and types: useGlobalSearch hook with debounced API calls, recent searches, entity URL resolver
- [x] 03-02-PLAN.md — GlobalSearchBar component and header integration: dropdown UI, keyboard navigation, highlighted matches, Cmd+K shortcut

### Phase 4: Full Search Page (DROPPED)

**Goal**: Dedicated search page with filtering, sorting, and pagination
**Status**: Dropped — typeahead covers core search UX; per-entity list pages handle deep browsing
**Requirements**: PAGE-01, PAGE-02, PAGE-03, PAGE-04 (deferred)

---

## Milestone Summary

**Key Decisions:**

- Dedicated search schema vs querying live tables: Isolates search reads from live write tables (search schema with search_index table)
- Trigger-based sync vs materialized view refresh: Triggers give sub-second freshness in same transaction
- Typeahead parallel queries: Query each entity type separately (max 7 parallel) instead of single query with grouping
- Sort by updated_at: Use updated_at desc instead of ts_rank (Supabase JS doesn't expose ts_rank)
- Access control marketplace pattern: Candidates, jobs, companies, recruiters visible to all; applications/placements company-scoped
- orgWideOrganizationIds on AccessContext: Distinguishes org-wide from company-scoped memberships
- DaisyUI v5 flex input pattern: Use `<label class="input">` as flex container for search bar
- Deep link query params for entity URLs: Portal uses `?candidateId=x` not `/candidates/:id`
- 250ms debounce for typeahead (faster than standard 300ms)
- AbortController for request cancellation (prevents stale results)

**Issues Resolved:**

- Recruiters ILIKE search migrated to tsvector full-text search
- Port conflict: search-service 3012 → 3013
- Missing deployment artifacts (Dockerfile, docker-compose, K8s, CI/CD) added
- PostgREST schema exposure for search schema
- Migration column mismatches (applications notes, placements recruiter_name)
- Search bar icon alignment (absolute positioning → DaisyUI flex pattern)
- Entity URLs using path segments instead of deep link query params
- Access control not filtering by company_id (only organization_id, which was populated incorrectly)

**Issues Deferred:**

- Recruiter_candidates visibility (currently only platform admins see in search — needs owner_id column)
- Full search page (PAGE-01 through PAGE-04)

**Technical Debt Incurred:**

- None significant

---

_For current project status, see .planning/ROADMAP.md_
