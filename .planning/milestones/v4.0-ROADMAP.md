# Milestone v4.0: Commute Types & Job Levels

**Status:** SHIPPED 2026-02-13
**Phases:** 8-10
**Total Plans:** 5

## Overview

Add commute type (multi-select) and job level (single-select) fields to the jobs system. Work flows from database schema and TypeScript types, through the ATS service API layer, to the portal frontend and search index. Three phases covering foundation, API, and consumer layers.

## Phases

### Phase 8: Schema & Types

**Goal**: The database and type system know about commute types and job levels
**Depends on**: Nothing (first phase of v4.0)
**Requirements**: SCHM-01, SCHM-02, SCHM-03, TYPE-01, TYPE-02, TYPE-03
**Success Criteria** (what must be TRUE):
  1. jobs table has commute_types TEXT[] and job_level TEXT columns with CHECK constraints enforcing valid values
  2. Both columns default to NULL and existing jobs are unaffected by the migration
  3. TypeScript union types for commute type values and job level values exist in shared-types
  4. Job model, CreateJobDTO, and JobDTO include the new fields as optional properties
**Plans**: 1 plan

Plans:
- [x] 08-01-PLAN.md -- Database migration adding commute_types/job_level columns + TypeScript union types and DTO updates

### Phase 9: API

**Goal**: The ATS service accepts, persists, returns, and filters by commute types and job levels
**Depends on**: Phase 8
**Requirements**: API-01, API-02, API-03, API-04, API-05
**Success Criteria** (what must be TRUE):
  1. POST /v2/jobs accepts commute_types and job_level and persists them to the database
  2. PATCH /v2/jobs/:id accepts commute_types and job_level and updates them
  3. GET /v2/jobs and GET /v2/jobs/:id return commute_types and job_level in the response
  4. Job list endpoint supports filtering by commute_type (any-match against array) and job_level
**Plans**: 1 plan

Plans:
- [x] 09-01-PLAN.md -- ATS service types, repository filtering, and service validation for commute_types and job_level

### Phase 10: Frontend & Search

**Goal**: Users can set, view, and filter by commute types and job levels in the portal
**Depends on**: Phase 9
**Requirements**: UI-01, UI-02, UI-03, UI-04, UI-05, UI-06, SRCH-01
**Success Criteria** (what must be TRUE):
  1. Job create/edit form has a commute type multi-select (checkboxes) and a job level dropdown
  2. Job detail view displays commute types and job level with human-readable labels
  3. Job list page supports filtering by commute type and job level
  4. Search index includes commute_types and job_level so jobs appear in search results by these fields
**Plans**: 3 plans

Plans:
- [x] 10-01-PLAN.md -- Wizard form commute type checkboxes and job level dropdown with modal state wiring
- [x] 10-02-PLAN.md -- Job detail display cards and list filter controls for commute type and job level
- [x] 10-03-PLAN.md -- Search index trigger update to include commute_types and job_level in metadata and context

## Progress

**Execution Order:** 8 -> 9 -> 10

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 8. Schema & Types | 1/1 | Complete | 2026-02-13 |
| 9. API | 1/1 | Complete | 2026-02-13 |
| 10. Frontend & Search | 3/3 | Complete | 2026-02-13 |

---

## Milestone Summary

**Key Decisions:**

- commute_types as TEXT[] array: Multi-select per job with Postgres @> filtering (✓ Good)
- Hybrid granularity hybrid_1 through hybrid_4: Full 1-4 days in office granularity (✓ Good)
- job_level as TEXT with CHECK constraint: 8 levels, text over enum for easier extension (✓ Good)
- Keep open_to_relocation as-is: Orthogonal to commute type (✓ Good)
- Supabase .overlaps() for commute_type array filtering (✓ Good)
- Self-contained VALID_COMMUTE_TYPES/VALID_JOB_LEVELS const arrays in service.ts (✓ Good)
- Conditional payload inclusion: only send fields if set, preserves null on edit (✓ Good)
- Label maps for human-readable display in detail views (✓ Good)
- Single-select dropdowns for filter controls matching API any-match semantics (✓ Good)

**Issues Resolved:**

None — clean execution with zero deviations across all 5 plans.

**Issues Deferred:**

None.

**Technical Debt Incurred:**

None identified in milestone audit.

---

_For current project status, see .planning/ROADMAP.md_
