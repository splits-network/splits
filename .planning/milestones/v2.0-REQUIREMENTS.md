# Requirements Archive: v2.0 Global Search

**Archived:** 2026-02-14
**Status:** SHIPPED (Phase 4 dropped)

This is the archived requirements specification for v2.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: Global Search

**Defined:** 2026-02-12
**Core Value:** Users find anything in the platform by typing natural language queries and getting ranked, cross-entity results in real-time.

## v1 Requirements

Requirements for milestone v2.0. Each maps to roadmap phases.

### Search Infrastructure

- [x] **INFRA-01**: Dedicated `search` schema with unified `search_index` table (entity_type, entity_id, title, subtitle, context, search_vector, metadata, organization_id)
- [x] **INFRA-02**: Trigger-based sync from candidates table to search_index (near-real-time, same transaction)
- [x] **INFRA-03**: Trigger-based sync from jobs table to search_index
- [x] **INFRA-04**: Trigger-based sync from companies table to search_index
- [x] **INFRA-05**: Trigger-based sync from recruiters table to search_index
- [x] **INFRA-06**: Trigger-based sync from applications table to search_index
- [x] **INFRA-07**: Trigger-based sync from placements table to search_index
- [x] **INFRA-08**: GIN index on search_index.search_vector with ts_rank scoring
- [x] **INFRA-09**: Recruiters table migrated from ILIKE to tsvector search (prerequisite for trigger sync)

### API

- [x] **API-01**: GET /v2/search endpoint querying search.search_index with typeahead mode (top 5 per entity) and full mode (paginated)
- [x] **API-02**: Access control filtering on all search results via resolveAccessContext (users only see entities they have access to)
- [x] **API-03**: Input sanitization and query validation (min query length, special character handling, injection prevention)

### Typeahead

- [x] **TYPE-01**: Real-time typeahead dropdown in portal header showing top results per entity type
- [x] **TYPE-02**: Results grouped by entity type with count and icon (Candidates, Jobs, Companies, etc.)
- [x] **TYPE-03**: Keyboard navigation (arrow keys to select, Enter to navigate, Esc to close dropdown)
- [x] **TYPE-04**: Loading states while searching and empty state messaging when no results found
- [x] **TYPE-05**: Highlighted matches (bold matching terms in result text)
- [x] **TYPE-06**: Context snippets showing match context (subtitle/secondary text from search_index)
- [x] **TYPE-07**: Click any result to navigate to entity detail page
- [x] **TYPE-08**: Clear button (X) to reset search input and close dropdown

### Full Search Page (DROPPED)

- [ ] **PAGE-01**: Dedicated /portal/search page with paginated results (25 per page) — *Deferred: typeahead sufficient*
- [ ] **PAGE-02**: Entity type filtering (All, Candidates, Jobs, Companies, Recruiters, Applications, Placements) — *Deferred*
- [ ] **PAGE-03**: Sort options (relevance, date) — *Deferred*
- [ ] **PAGE-04**: Pressing Enter in typeahead without selection navigates to full search page with query preserved — *Replaced: Enter now selects top result*

### Platform Integration

- [x] **INT-01**: Cmd+K (Mac) / Ctrl+K (Windows) keyboard shortcut opens/focuses search from any page
- [x] **INT-02**: Recent searches stored in localStorage, shown in dropdown when input is empty (last 5)

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| INFRA-01 | Phase 1 | **Complete** (01-01) |
| INFRA-02 | Phase 1 | **Complete** (01-02) |
| INFRA-03 | Phase 1 | **Complete** (01-02) |
| INFRA-04 | Phase 1 | **Complete** (01-02) |
| INFRA-05 | Phase 1 | **Complete** (01-03) |
| INFRA-06 | Phase 1 | **Complete** (01-03) |
| INFRA-07 | Phase 1 | **Complete** (01-03) |
| INFRA-08 | Phase 1 | **Complete** (01-01) |
| INFRA-09 | Phase 1 | **Complete** (01-01) |
| API-01 | Phase 2 | **Complete** (02-01) |
| API-02 | Phase 2 | **Complete** (02-01) |
| API-03 | Phase 2 | **Complete** (02-01) |
| TYPE-01 | Phase 3 | **Complete** (03-02) |
| TYPE-02 | Phase 3 | **Complete** (03-02) |
| TYPE-03 | Phase 3 | **Complete** (03-02) |
| TYPE-04 | Phase 3 | **Complete** (03-02) |
| TYPE-05 | Phase 3 | **Complete** (03-02) |
| TYPE-06 | Phase 3 | **Complete** (03-02) |
| TYPE-07 | Phase 3 | **Complete** (03-02) |
| TYPE-08 | Phase 3 | **Complete** (03-02) |
| PAGE-01 | Phase 4 | **Dropped** |
| PAGE-02 | Phase 4 | **Dropped** |
| PAGE-03 | Phase 4 | **Dropped** |
| PAGE-04 | Phase 4 | **Dropped** (replaced by Enter→top result) |
| INT-01 | Phase 3 | **Complete** (03-01) |
| INT-02 | Phase 3 | **Complete** (03-01) |

---

## Milestone Summary

**Shipped:** 21 of 25 v1 requirements
**Adjusted:** PAGE-04 — Enter now selects top search result instead of navigating to a full search page
**Dropped:** PAGE-01, PAGE-02, PAGE-03, PAGE-04 — Full search page deemed unnecessary; typeahead covers core UX, per-entity list pages handle deep browsing

---
*Archived: 2026-02-14 as part of v2.0 milestone completion*
