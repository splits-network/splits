---
phase: 07-type-alignment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/shared-types/src/dtos.ts
  - packages/shared-clients/src/identity-client.ts
autonomous: true

must_haves:
  truths:
    - "UserRoleDTO.role_entity_id is string | null"
    - "IdentityClient.createUserRole accepts role_entity_id as optional and nullable"
    - "All affected packages build cleanly with zero TypeScript errors"
  artifacts:
    - path: "packages/shared-types/src/dtos.ts"
      provides: "UserRoleDTO with nullable role_entity_id"
      contains: "role_entity_id: string | null"
    - path: "packages/shared-clients/src/identity-client.ts"
      provides: "createUserRole with optional nullable role_entity_id"
      contains: "role_entity_id?"
---

<objective>
Fix 2 TypeScript type definitions where role_entity_id is incorrectly typed as required/non-nullable. After Phase 4 made role_entity_id nullable in the database and Phase 5 updated the service layer, these DTO and client types need to match.

Purpose: Close tech debt identified in v3.0 milestone audit. Prevents TypeScript errors when callers use createUserRole for platform_admin (which has null entity_id).

Output: Two files updated, all packages build cleanly.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/v3.0-MILESTONE-AUDIT.md (tech debt section)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix nullable role_entity_id in UserRoleDTO and IdentityClient</name>
  <files>
    packages/shared-types/src/dtos.ts
    packages/shared-clients/src/identity-client.ts
  </files>
  <action>
**packages/shared-types/src/dtos.ts** (line 17):
- Change `role_entity_id: string;` to `role_entity_id: string | null;`

**packages/shared-clients/src/identity-client.ts** (line 49):
- Change `role_entity_id: string;` to `role_entity_id?: string | null;`
- Update the comment on line 41 from "User Role endpoints (entity-linked: recruiter, candidate)" to "User Role endpoints (entity-linked: recruiter, candidate; system-level: platform_admin)"

After changes, run:
```
pnpm --filter @splits-network/shared-types build && pnpm --filter @splits-network/shared-clients build
```

Verify zero TypeScript errors.
  </action>
  <verify>
Run build commands for both packages. Both must compile with zero errors.
  </verify>
  <done>UserRoleDTO.role_entity_id is string | null, createUserRole accepts optional nullable role_entity_id, both packages build cleanly</done>
</task>

</tasks>

<verification>
1. UserRoleDTO.role_entity_id is `string | null` in dtos.ts
2. createUserRole role_entity_id is `string | null | undefined` in identity-client.ts
3. Both shared-types and shared-clients build with zero errors
</verification>

<success_criteria>
- packages/shared-types/src/dtos.ts has `role_entity_id: string | null`
- packages/shared-clients/src/identity-client.ts has `role_entity_id?: string | null`
- Both packages build cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/07-type-alignment/07-01-SUMMARY.md`
</output>
