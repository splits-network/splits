---
phase: 10-frontend-and-search
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/portal/src/app/portal/roles/types.ts
  - apps/portal/src/app/portal/roles/components/details-view.tsx
  - apps/portal/src/app/portal/roles/components/detail-sidebar.tsx
  - apps/portal/src/app/portal/roles/components/header-filters.tsx
autonomous: true

must_haves:
  truths:
    - "Job detail view shows commute types with human-readable labels"
    - "Job detail view shows job level with human-readable label"
    - "Job list filter dropdown has commute type multi-select"
    - "Job list filter dropdown has job level dropdown"
    - "Selecting a commute type or job level filter triggers server-side filtered refresh"
  artifacts:
    - path: "apps/portal/src/app/portal/roles/types.ts"
      provides: "UnifiedJobFilters with commute_type and job_level, Job with commute_types and job_level"
      contains: "commute_type"
    - path: "apps/portal/src/app/portal/roles/components/details-view.tsx"
      provides: "QuickStatsSection cards for commute types and job level"
      contains: "commute_types"
    - path: "apps/portal/src/app/portal/roles/components/header-filters.tsx"
      provides: "Commute type and job level filter controls in dropdown"
      contains: "commute_type"
  key_links:
    - from: "header-filters.tsx"
      to: "types.ts"
      via: "UnifiedJobFilters keys used in setFilter calls"
      pattern: "setFilter.*commute_type"
    - from: "header-filters.tsx"
      to: "roles-filter-context.tsx"
      via: "Filter params propagated via useStandardList to API"
      pattern: "commute_type"
    - from: "details-view.tsx"
      to: "Job interface"
      via: "job.commute_types and job.job_level accessed in QuickStatsSection"
      pattern: "job\\.commute_types"
---

<objective>
Add commute type and job level display to job detail views and add filter controls to job list.

Purpose: Users need to see commute types and job level on job details (UI-03, UI-04) and filter job lists by these fields (UI-05, UI-06).
Output: Updated QuickStatsSection with new cards, updated filter dropdown with new controls, extended type interfaces.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/portal/src/app/portal/roles/types.ts
@apps/portal/src/app/portal/roles/components/details-view.tsx
@apps/portal/src/app/portal/roles/components/detail-sidebar.tsx
@apps/portal/src/app/portal/roles/components/header-filters.tsx
@apps/portal/src/app/portal/roles/contexts/roles-filter-context.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend types and add display cards to detail views</name>
  <files>
    apps/portal/src/app/portal/roles/types.ts
    apps/portal/src/app/portal/roles/components/details-view.tsx
    apps/portal/src/app/portal/roles/components/detail-sidebar.tsx
  </files>
  <action>
    1. In `types.ts`:
       a) Add to the Job interface, after `is_remote?: boolean`:
          ```typescript
          commute_types?: string[] | null;
          job_level?: string | null;
          ```
       b) Add to UnifiedJobFilters:
          ```typescript
          commute_type?: string;
          job_level?: string;
          ```

    2. In `details-view.tsx`:
       a) Add to the local Job interface (around line 33), after `open_to_relocation`:
          ```typescript
          commute_types?: string[] | null;
          job_level?: string | null;
          ```

       b) Add a label map object near the top of the file (after the existing helper functions, around line 96):
          ```typescript
          const COMMUTE_TYPE_LABELS: Record<string, string> = {
              remote: 'Remote',
              hybrid_1: 'Hybrid (1 day in office)',
              hybrid_2: 'Hybrid (2 days in office)',
              hybrid_3: 'Hybrid (3 days in office)',
              hybrid_4: 'Hybrid (4 days in office)',
              in_office: 'In Office',
          };

          const JOB_LEVEL_LABELS: Record<string, string> = {
              entry: 'Entry Level',
              mid: 'Mid Level',
              senior: 'Senior',
              lead: 'Lead',
              manager: 'Manager',
              director: 'Director',
              vp: 'VP',
              c_suite: 'C-Suite',
          };
          ```

       c) In the QuickStatsSection function, add TWO new cards inside the grid (after the Employment Type card and before the Department card):

          **Commute Types card** (only render if commute_types has items):
          ```tsx
          {job.commute_types && job.commute_types.length > 0 && (
              <div className="bg-base-200/50 p-3 rounded-lg">
                  <div className=" text-base-content/60 mb-1">
                      <i className="fa-duotone fa-building-user mr-1" />
                      Work Arrangement
                  </div>
                  <div className="font-medium text-sm">
                      {job.commute_types.map(ct => COMMUTE_TYPE_LABELS[ct] || ct).join(', ')}
                  </div>
              </div>
          )}
          ```

          **Job Level card** (only render if job_level is set):
          ```tsx
          {job.job_level && (
              <div className="bg-base-200/50 p-3 rounded-lg">
                  <div className=" text-base-content/60 mb-1">
                      <i className="fa-duotone fa-signal mr-1" />
                      Job Level
                  </div>
                  <div className="font-medium text-sm">
                      {JOB_LEVEL_LABELS[job.job_level] || job.job_level}
                  </div>
              </div>
          )}
          ```

    3. In `detail-sidebar.tsx`:
       Add to the local Job interface (around line 12-37), after `open_to_relocation`:
       ```typescript
       commute_types?: string[] | null;
       job_level?: string | null;
       ```
       Note: detail-sidebar.tsx has `[key: string]: any;` so it won't break without these fields, but adding them provides proper typing.
  </action>
  <verify>Run `pnpm --filter @splits-network/portal build` and confirm zero type errors. Grep for "commute_types" in details-view.tsx to confirm the card renders.</verify>
  <done>Job detail QuickStatsSection shows commute types (with human-readable labels, comma-separated) and job level cards. All local Job interfaces include the new fields. UnifiedJobFilters includes commute_type and job_level.</done>
</task>

<task type="auto">
  <name>Task 2: Add commute type and job level filters to header dropdown</name>
  <files>
    apps/portal/src/app/portal/roles/components/header-filters.tsx
  </files>
  <action>
    In header-filters.tsx:

    1. Update the `handleReset` callback to also clear the new filters:
       ```typescript
       setFilter("commute_type", undefined);
       setFilter("job_level", undefined);
       ```

    2. Update the `activeFilterCount` array to include the new filters:
       ```typescript
       const activeFilterCount = [
           filters.status,
           filters.employment_type,
           filters.is_remote,
           filters.commute_type,
           filters.job_level,
       ].filter(Boolean).length;
       ```

    3. Add TWO new filter fieldsets inside the dropdown panel, after the Employment Type fieldset and before the "Remote Only" toggle:

       a) **Commute Type filter** - a single-select dropdown (selecting one commute type filters for jobs that include that type, matching the API's any-match semantics):
       ```tsx
       <fieldset className="fieldset">
           <legend className="fieldset-legend">Commute Type</legend>
           <select
               className="select select-sm w-full"
               value={filters.commute_type || ""}
               onChange={(e) => setFilter("commute_type", e.target.value || undefined)}
           >
               <option value="">All Commute Types</option>
               <option value="remote">Remote</option>
               <option value="hybrid_1">Hybrid (1 day)</option>
               <option value="hybrid_2">Hybrid (2 days)</option>
               <option value="hybrid_3">Hybrid (3 days)</option>
               <option value="hybrid_4">Hybrid (4 days)</option>
               <option value="in_office">In Office</option>
           </select>
       </fieldset>
       ```

       b) **Job Level filter** - a single-select dropdown:
       ```tsx
       <fieldset className="fieldset">
           <legend className="fieldset-legend">Job Level</legend>
           <select
               className="select select-sm w-full"
               value={filters.job_level || ""}
               onChange={(e) => setFilter("job_level", e.target.value || undefined)}
           >
               <option value="">All Levels</option>
               <option value="entry">Entry Level</option>
               <option value="mid">Mid Level</option>
               <option value="senior">Senior</option>
               <option value="lead">Lead</option>
               <option value="manager">Manager</option>
               <option value="director">Director</option>
               <option value="vp">VP</option>
               <option value="c_suite">C-Suite</option>
           </select>
       </fieldset>
       ```

    4. Remove the "Remote Only" toggle entirely. It is superseded by the commute_type filter (users can select "Remote" from the commute type dropdown instead). Also remove `is_remote` from the handleReset and activeFilterCount.

       WAIT - actually, keep the Remote Only toggle for backward compatibility. The is_remote filter serves a different purpose (it's a boolean on the job record). Leave it as-is. The commute_type filter is additive.
  </action>
  <verify>Run `pnpm --filter @splits-network/portal build` and confirm zero errors. Verify header-filters.tsx has both new filter fieldsets by grepping for "commute_type" and "job_level".</verify>
  <done>Filter dropdown includes Commute Type (6 options) and Job Level (8 options) dropdowns. Active filter count includes the new filters. Reset clears them. Filter values propagate through useStandardList to the API automatically via UnifiedJobFilters.</done>
</task>

</tasks>

<verification>
- `pnpm --filter @splits-network/portal build` passes with zero errors
- details-view.tsx QuickStatsSection renders Commute Types and Job Level cards
- header-filters.tsx dropdown has Commute Type and Job Level selects
- UnifiedJobFilters in types.ts includes commute_type and job_level
- detail-sidebar.tsx Job interface includes commute_types and job_level
</verification>

<success_criteria>
- Job detail view displays commute types and job level with human-readable labels
- Job list filter dropdown supports filtering by commute type and job level
- Selecting a filter triggers a server-side filtered data refresh via useStandardList
- Portal build passes without type errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-frontend-and-search/10-02-SUMMARY.md`
</output>
