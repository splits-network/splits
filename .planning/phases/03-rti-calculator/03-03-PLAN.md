---
phase: 03-rti-calculator
plan: 03
type: execute
wave: 3
depends_on: ["03-01", "03-02"]
files_modified:
    - apps/portal/src/components/calculator/rti-calculator.tsx
    - apps/portal/src/components/calculator/index.ts
    - apps/portal/src/app/pricing/pricing-content.tsx
autonomous: false

must_haves:
    truths:
        - "Calculator layout adapts to mobile (stacks vertically on small screens)"
        - "Calculator component is exported and reusable (could be embedded elsewhere)"
        - "Calculator is integrated on pricing page with proper section styling"
        - "Scroll-triggered entrance animation on calculator section"
    artifacts:
        - path: "apps/portal/src/components/calculator/rti-calculator.tsx"
          provides: "Complete RTI calculator component combining all subcomponents"
          exports: ["RTICalculator"]
        - path: "apps/portal/src/app/pricing/pricing-content.tsx"
          provides: "Pricing page with integrated RTI calculator section"
          contains: "RTICalculator"
    key_links:
        - from: "rti-calculator.tsx"
          to: "use-calculator.ts"
          via: "uses useCalculator hook for state management"
          pattern: "import.*useCalculator"
        - from: "pricing-content.tsx"
          to: "rti-calculator.tsx"
          via: "renders RTICalculator in dedicated section"
          pattern: "import.*RTICalculator"
---

<objective>
Create the complete RTICalculator component, make it mobile-responsive, and integrate it on the pricing page with scroll-triggered animations.

Purpose: This brings everything together - the calculator becomes a usable, prominent feature on the pricing page that helps recruiters see the concrete value of upgrading tiers.
Output: Complete RTICalculator component integrated on pricing page with mobile responsiveness and entrance animation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-rti-calculator/03-01-SUMMARY.md
@.planning/phases/03-rti-calculator/03-02-SUMMARY.md
@apps/portal/src/app/pricing/pricing-content.tsx
@apps/portal/src/components/calculator/index.ts
@apps/portal/src/components/landing/shared/animation-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RTICalculator composite component</name>
  <files>apps/portal/src/components/calculator/rti-calculator.tsx</files>
  <action>
Create the complete RTICalculator component that combines FeeInput, RoleSelector, and TierComparison.

```typescript
'use client';

import { useRef } from 'react';
import gsap from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';
import { useGSAP } from '@gsap/react';
import { duration, easing } from '@/components/landing/shared/animation-utils';
import { useCalculator } from './use-calculator';
import { FeeInput } from './fee-input';
import { RoleSelector } from './role-selector';
import { TierComparison } from './tier-comparison';

if (typeof window !== 'undefined') {
  gsap.registerPlugin(ScrollTrigger);
}

interface RTICalculatorProps {
  /** Optional: Enable scroll-triggered entrance animation */
  animate?: boolean;
  /** Optional: Custom class for the container */
  className?: string;
}

export function RTICalculator({ animate = false, className = '' }: RTICalculatorProps) {
  const containerRef = useRef<HTMLDivElement>(null);
  const contentRef = useRef<HTMLDivElement>(null);

  const {
    state,
    effectiveFee,
    payouts,
    upgradeValue,
    setInputMode,
    setPlacementFee,
    setSalary,
    setFeePercentage,
    toggleRole,
  } = useCalculator();

  // Scroll-triggered entrance animation
  useGSAP(
    () => {
      if (!animate || !containerRef.current || !contentRef.current) return;

      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReducedMotion) return;

      gsap.fromTo(
        contentRef.current,
        { opacity: 0, y: 40 },
        {
          opacity: 1,
          y: 0,
          duration: duration.normal,
          ease: easing.smooth,
          scrollTrigger: {
            trigger: containerRef.current,
            start: 'top 75%',
          },
        }
      );
    },
    { scope: containerRef, dependencies: [animate] }
  );

  return (
    <div ref={containerRef} className={className}>
      <div ref={contentRef} className={animate ? 'opacity-0' : ''}>
        {/* Mobile: Stack vertically, Desktop: Side by side */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
          {/* Input Section - Left side on desktop */}
          <div className="lg:col-span-5 space-y-6">
            <div className="card bg-base-100 shadow-lg">
              <div className="card-body">
                <h3 className="card-title text-lg mb-4">
                  <i className="fa-duotone fa-regular fa-calculator text-primary"></i>
                  Calculate Your Earnings
                </h3>
                <FeeInput
                  inputMode={state.inputMode}
                  placementFee={state.placementFee}
                  salary={state.salary}
                  feePercentage={state.feePercentage}
                  effectiveFee={effectiveFee}
                  onInputModeChange={setInputMode}
                  onPlacementFeeChange={setPlacementFee}
                  onSalaryChange={setSalary}
                  onFeePercentageChange={setFeePercentage}
                />
                <div className="divider my-4"></div>
                <RoleSelector
                  selectedRoles={state.selectedRoles}
                  onToggleRole={toggleRole}
                />
              </div>
            </div>
          </div>

          {/* Results Section - Right side on desktop */}
          <div className="lg:col-span-7">
            <div className="card bg-base-100 shadow-lg h-full">
              <div className="card-body">
                <h3 className="card-title text-lg mb-4">
                  <i className="fa-duotone fa-regular fa-chart-column text-secondary"></i>
                  Your Payout by Tier
                </h3>
                <TierComparison
                  payouts={payouts}
                  upgradeValue={upgradeValue}
                  effectiveFee={effectiveFee}
                />
              </div>
            </div>
          </div>
        </div>

        {/* Disclaimer */}
        <div className="text-center mt-6 text-sm text-base-content/50">
          <i className="fa-duotone fa-regular fa-info-circle mr-1"></i>
          Payouts are illustrative and based on current commission rates. Actual payouts are finalized at hire time.
        </div>
      </div>
    </div>
  );
}
```

Key features:

- Combines all calculator subcomponents (FeeInput, RoleSelector, TierComparison)
- Responsive layout: stacked on mobile (grid-cols-1), side-by-side on desktop (lg:grid-cols-12)
- Optional scroll-triggered entrance animation via `animate` prop
- Animation respects prefers-reduced-motion
- Cards with shadows for visual separation
- Disclaimer footer
- Fully self-contained and reusable
  </action>
  <verify>

1. File exists: `ls apps/portal/src/components/calculator/rti-calculator.tsx`
2. Has responsive grid: `grep "grid-cols-1 lg:grid-cols-12" apps/portal/src/components/calculator/rti-calculator.tsx`
3. Uses all subcomponents: `grep -E "(FeeInput|RoleSelector|TierComparison)" apps/portal/src/components/calculator/rti-calculator.tsx`
4. Build check: `pnpm --filter @splits-network/portal build` passes
   </verify>
   <done>
   RTICalculator is a complete, self-contained component combining FeeInput, RoleSelector, and TierComparison. Layout is responsive (stacks on mobile, side-by-side on desktop). Optional entrance animation via animate prop.
   </done>
   </task>

<task type="auto">
  <name>Task 2: Update barrel export and integrate on pricing page</name>
  <files>
    apps/portal/src/components/calculator/index.ts
    apps/portal/src/app/pricing/pricing-content.tsx
  </files>
  <action>
**Update index.ts to export RTICalculator:**

Add to index.ts:

```typescript
export * from "./rti-calculator";
```

**Update pricing-content.tsx to add RTI Calculator section:**

Add the calculator section between the "For Companies" section and the "Feature Comparison" section. This placement makes sense because:

1. After seeing tier prices, users want to understand actual earnings
2. Before the feature comparison table, show the concrete dollar impact

Import at the top (add to existing imports):

```typescript
import { RTICalculator } from "@/components/calculator";
```

Add new section after the "For Companies" section (after line ~449, before Feature Comparison):

```tsx
{
    /* RTI Calculator Section */
}
<section className="py-20 bg-base-100">
    <div className="container mx-auto px-4">
        <div className="text-center mb-12">
            <h2 className="text-4xl font-bold mb-4">
                <i className="fa-duotone fa-regular fa-calculator text-primary"></i>{" "}
                Calculate Your Earnings
            </h2>
            <p className="text-lg text-base-content/70 max-w-2xl mx-auto">
                See exactly how much you'll earn on a placement across
                subscription tiers. Higher tiers mean more of the fee goes
                directly to you.
            </p>
        </div>
        <div className="max-w-6xl mx-auto">
            <RTICalculator animate />
        </div>
    </div>
</section>;
```

Move the existing "Feature Comparison" section's `bg-base-100` to `bg-base-200` to create visual separation:

- Find: `<section className="py-20 bg-base-100">` (Feature Comparison section)
- Change to: `<section className="py-20 bg-base-200">`
  </action>
  <verify>

1. Index.ts updated: `grep "rti-calculator" apps/portal/src/components/calculator/index.ts`
2. Pricing page imports calculator: `grep "RTICalculator" apps/portal/src/app/pricing/pricing-content.tsx`
3. Calculator section exists: `grep "Calculate Your Earnings" apps/portal/src/app/pricing/pricing-content.tsx`
4. Build check: `pnpm --filter @splits-network/portal build` passes
   </verify>
   <done>
   RTICalculator exported from calculator index. Pricing page has dedicated calculator section with proper heading, description, and the calculator component with entrance animation enabled.
   </done>
   </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete RTI Calculator on pricing page with:
- Fee input (direct fee or salary + %)
- Role multi-select (5 recruiter roles)
- Three-tier payout comparison with animated counters
- Upgrade value highlighting
- Mobile-responsive layout
- Scroll-triggered entrance animation</what-built>
  <how-to-verify>
1. Start dev server: `pnpm --filter @splits-network/portal dev`
2. Visit http://localhost:3100/pricing
3. Scroll to "Calculate Your Earnings" section

**Verify inputs:**

- [ ] Toggle between "Direct Fee" and "Salary + %" modes works
- [ ] Direct fee input accepts numbers (try $20,000)
- [ ] Salary mode shows salary + percentage inputs
- [ ] Salary mode displays calculated fee below inputs
- [ ] Role checkboxes are selectable (try selecting multiple)
- [ ] Warning appears if no roles selected

**Verify outputs:**

- [ ] Three tier columns display (Starter, Pro, Partner)
- [ ] Pro column is visually emphasized (primary background)
- [ ] Payout numbers animate when inputs change
- [ ] Upgrade value badges show "+$X vs. Starter"
- [ ] ROI summary message displays when values are non-zero
- [ ] Breakdown details expand/collapse works

**Verify responsiveness:**

- [ ] On desktop (>1024px): inputs on left, results on right
- [ ] On mobile (<1024px): inputs stack above results
- [ ] All elements remain usable on mobile

**Verify animation:**

- [ ] Calculator section fades in on scroll
- [ ] With prefers-reduced-motion enabled in OS, animations are skipped

**Verify integration:**

- [ ] Calculator section appears between "For Companies" and "Feature Comparison"
- [ ] Styling is consistent with rest of pricing page
      </how-to-verify>
      <resume-signal>Type "approved" if all checks pass, or describe any issues found.</resume-signal>
      </task>

</tasks>

<verification>
1. `pnpm --filter @splits-network/portal build` completes without errors
2. RTICalculator component is reusable (can be imported from @/components/calculator)
3. Calculator layout is responsive (stacks on mobile, side-by-side on desktop)
4. Calculator section appears on pricing page with proper heading
5. Entrance animation triggers on scroll
6. All calculator features work (fee input, role selection, animated payouts, upgrade highlighting)
7. Reduced motion preference is respected
</verification>

<success_criteria>

- RTICalculator exported from @/components/calculator
- RTICalculator has `animate` prop for optional scroll animation
- Pricing page has "Calculate Your Earnings" section between "For Companies" and "Feature Comparison"
- Layout uses lg:grid-cols-12 for responsive side-by-side on desktop
- Layout uses grid-cols-1 for stacked mobile layout
- Calculator section has scroll-triggered fadeUp entrance animation
- All user interactions work (input, toggle, checkbox, collapsible)
- Animated payouts count up smoothly when values change
- Upgrade badges show dollar difference vs Starter tier
- Build passes with no TypeScript errors
- Human verification confirms all features work as expected
  </success_criteria>

<output>
After completion and human verification, create `.planning/phases/03-rti-calculator/03-03-SUMMARY.md`
</output>
