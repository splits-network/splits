---
phase: 03-rti-calculator
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
    - apps/portal/src/components/calculator/tier-comparison.tsx
    - apps/portal/src/components/calculator/animated-payout.tsx
    - apps/portal/src/components/calculator/index.ts
autonomous: true

must_haves:
    truths:
        - "Three columns display payout amounts for Free, Paid, and Premium tiers side-by-side"
        - "Payout numbers animate (count up) when inputs change"
        - "Upgrade value is visually highlighted showing dollar difference between tiers"
        - "Animations respect prefers-reduced-motion preference"
    artifacts:
        - path: "apps/portal/src/components/calculator/tier-comparison.tsx"
          provides: "Three-column tier comparison display with upgrade highlights"
          exports: ["TierComparison"]
        - path: "apps/portal/src/components/calculator/animated-payout.tsx"
          provides: "Animated number counter component using GSAP"
          exports: ["AnimatedPayout"]
    key_links:
        - from: "animated-payout.tsx"
          to: "animation-utils.ts"
          via: "imports duration, easing for counter animation"
          pattern: "import.*duration.*easing.*animation-utils"
        - from: "tier-comparison.tsx"
          to: "animated-payout.tsx"
          via: "uses AnimatedPayout for payout display"
          pattern: "import.*AnimatedPayout"
---

<objective>
Create the tier comparison display with animated payout counters and upgrade value highlighting.

Purpose: This is the visual core of the calculator - showing recruiters exactly how much more they earn with higher tiers. The animated counters draw attention and make the numbers feel dynamic when inputs change.
Output: TierComparison component with three columns showing animated payouts and highlighted upgrade values.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-rti-calculator/03-01-SUMMARY.md
@apps/portal/src/components/calculator/types.ts
@apps/portal/src/components/calculator/commission-rates.ts
@apps/portal/src/components/landing/shared/animation-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnimatedPayout component with GSAP counter</name>
  <files>apps/portal/src/components/calculator/animated-payout.tsx</files>
  <action>
Create a reusable animated number component that counts up to the target value using GSAP.

```typescript
'use client';

import { useRef, useEffect, useState } from 'react';
import gsap from 'gsap';
import { duration, easing } from '@/components/landing/shared/animation-utils';

interface AnimatedPayoutProps {
  value: number;
  prefix?: string;
  className?: string;
  highlightChange?: boolean;
}

export function AnimatedPayout({
  value,
  prefix = '$',
  className = '',
  highlightChange = false,
}: AnimatedPayoutProps) {
  const [displayValue, setDisplayValue] = useState(value);
  const [isAnimating, setIsAnimating] = useState(false);
  const previousValue = useRef(value);
  const animationRef = useRef<gsap.core.Tween | null>(null);

  useEffect(() => {
    // Check for reduced motion preference
    const prefersReducedMotion =
      typeof window !== 'undefined' &&
      window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // Kill any existing animation
    if (animationRef.current) {
      animationRef.current.kill();
    }

    if (prefersReducedMotion) {
      // Skip animation, set value immediately
      setDisplayValue(value);
      previousValue.current = value;
      return;
    }

    // Animate from previous value to new value
    const startValue = previousValue.current;
    setIsAnimating(true);

    const obj = { val: startValue };
    animationRef.current = gsap.to(obj, {
      val: value,
      duration: duration.counter,
      ease: easing.smooth,
      onUpdate: () => {
        setDisplayValue(Math.round(obj.val));
      },
      onComplete: () => {
        setIsAnimating(false);
        previousValue.current = value;
      },
    });

    return () => {
      if (animationRef.current) {
        animationRef.current.kill();
      }
    };
  }, [value]);

  const formatNumber = (num: number) => {
    return new Intl.NumberFormat('en-US').format(num);
  };

  return (
    <span
      className={`tabular-nums ${className} ${
        isAnimating && highlightChange ? 'text-primary transition-colors' : ''
      }`}
    >
      {prefix}
      {formatNumber(displayValue)}
    </span>
  );
}
```

Key features:

- Uses GSAP for smooth number animation (duration.counter = 1.5s)
- Respects prefers-reduced-motion (instant update if enabled)
- Animates from previous value to new value on change
- Optional highlight effect during animation
- Uses tabular-nums for consistent digit width
- Properly cleans up animation on unmount/value change
  </action>
  <verify>

1. File exists: `ls apps/portal/src/components/calculator/animated-payout.tsx`
2. Has GSAP import: `grep -l "import gsap" apps/portal/src/components/calculator/animated-payout.tsx`
3. Has animation-utils import: `grep "animation-utils" apps/portal/src/components/calculator/animated-payout.tsx`
4. Build check: `pnpm --filter @splits-network/portal build` passes
   </verify>
   <done>
   AnimatedPayout component animates number from previous to new value using GSAP counter animation. Respects reduced motion preference and cleans up animations properly.
   </done>
   </task>

<task type="auto">
  <name>Task 2: Create TierComparison component with three columns and upgrade highlighting</name>
  <files>apps/portal/src/components/calculator/tier-comparison.tsx</files>
  <action>
Create the tier comparison display showing payouts for all three tiers with upgrade value highlighting.

```typescript
'use client';

import { TierPayout } from './types';
import { AnimatedPayout } from './animated-payout';

interface TierComparisonProps {
  payouts: TierPayout[];
  upgradeValue: {
    paidVsFree: number;
    premiumVsFree: number;
    premiumVsPaid: number;
  };
  effectiveFee: number;
}

export function TierComparison({ payouts, upgradeValue, effectiveFee }: TierComparisonProps) {
  const freePayout = payouts.find((p) => p.tier === 'free');
  const paidPayout = payouts.find((p) => p.tier === 'paid');
  const premiumPayout = payouts.find((p) => p.tier === 'premium');

  if (!freePayout || !paidPayout || !premiumPayout) {
    return null;
  }

  const formatCurrency = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(value);
  };

  return (
    <div className="space-y-6">
      {/* Tier Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {/* Free Tier */}
        <div className="card bg-base-200 shadow">
          <div className="card-body p-4 text-center">
            <div className="badge badge-ghost mb-2">{freePayout.tierName}</div>
            <div className="text-sm text-base-content/60 mb-1">
              {formatCurrency(freePayout.monthlyPrice)}/mo
            </div>
            <div className="text-3xl font-bold mb-2">
              <AnimatedPayout value={freePayout.payout} highlightChange />
            </div>
            <div className="text-xs text-base-content/50">Your payout</div>
          </div>
        </div>

        {/* Paid Tier - Highlighted */}
        <div className="card bg-primary text-primary-content shadow-lg scale-[1.02]">
          <div className="card-body p-4 text-center">
            <div className="badge badge-secondary mb-2">{paidPayout.tierName}</div>
            <div className="text-sm opacity-80 mb-1">
              {formatCurrency(paidPayout.monthlyPrice)}/mo
            </div>
            <div className="text-3xl font-bold mb-2">
              <AnimatedPayout value={paidPayout.payout} highlightChange />
            </div>
            <div className="text-xs opacity-70">Your payout</div>
            {/* Upgrade Value Highlight */}
            {upgradeValue.paidVsFree > 0 && (
              <div className="mt-2 pt-2 border-t border-coral-content/20">
                <div className="badge badge-success gap-1">
                  <i className="fa-duotone fa-regular fa-arrow-up text-xs"></i>
                  +{formatCurrency(upgradeValue.paidVsFree)}
                </div>
                <div className="text-xs opacity-60 mt-1">vs. Starter</div>
              </div>
            )}
          </div>
        </div>

        {/* Premium Tier */}
        <div className="card bg-base-200 shadow border-2 border-yellow">
          <div className="card-body p-4 text-center">
            <div className="badge badge-accent mb-2">{premiumPayout.tierName}</div>
            <div className="text-sm text-base-content/60 mb-1">
              {formatCurrency(premiumPayout.monthlyPrice)}/mo
            </div>
            <div className="text-3xl font-bold mb-2">
              <AnimatedPayout value={premiumPayout.payout} highlightChange />
            </div>
            <div className="text-xs text-base-content/50">Your payout</div>
            {/* Upgrade Value Highlight */}
            {upgradeValue.premiumVsFree > 0 && (
              <div className="mt-2 pt-2 border-t border-base-300">
                <div className="badge badge-success gap-1">
                  <i className="fa-duotone fa-regular fa-arrow-up text-xs"></i>
                  +{formatCurrency(upgradeValue.premiumVsFree)}
                </div>
                <div className="text-xs text-base-content/50 mt-1">vs. Starter</div>
              </div>
            )}
          </div>
        </div>
      </div>

      {/* ROI Summary */}
      {effectiveFee > 0 && upgradeValue.premiumVsFree > 0 && (
        <div className="alert bg-success/10 border-success/30">
          <i className="fa-duotone fa-regular fa-lightbulb text-success text-xl"></i>
          <div>
            <div className="font-semibold">One placement pays for your upgrade</div>
            <div className="text-sm text-base-content/70">
              On a {formatCurrency(effectiveFee)} placement, upgrading to Partner earns you{' '}
              <span className="font-bold text-success">{formatCurrency(upgradeValue.premiumVsFree)}</span> more
              â€” that's {((upgradeValue.premiumVsFree / 249) * 100).toFixed(0)}% of the monthly cost recovered in one deal.
            </div>
          </div>
        </div>
      )}

      {/* Breakdown Details (Collapsible) */}
      <details className="collapse collapse-arrow bg-base-200">
        <summary className="collapse-title text-sm font-medium">
          <i className="fa-duotone fa-regular fa-chart-pie mr-2"></i>
          View breakdown details
        </summary>
        <div className="collapse-content">
          <div className="overflow-x-auto">
            <table className="table table-sm">
              <thead>
                <tr>
                  <th>Tier</th>
                  <th className="text-right">Your Payout</th>
                  <th className="text-right">Platform Take</th>
                </tr>
              </thead>
              <tbody>
                {payouts.map((payout) => (
                  <tr key={payout.tier}>
                    <td className="font-medium">{payout.tierName}</td>
                    <td className="text-right">{formatCurrency(payout.payout)}</td>
                    <td className="text-right text-base-content/60">
                      {formatCurrency(payout.platformTake)}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </details>
    </div>
  );
}
```

Key features:

- Three-column grid layout (stacks on mobile via grid-cols-1 md:grid-cols-3)
- Pro tier visually emphasized (bg-primary, scale-[1.02])
- Premium tier has accent border for distinction
- Upgrade value badges show dollar difference vs Starter
- ROI summary alert shows how quickly upgrade pays for itself
- Collapsible breakdown details table
- All payout values use AnimatedPayout component
  </action>
  <verify>

1. File exists: `ls apps/portal/src/components/calculator/tier-comparison.tsx`
2. Imports AnimatedPayout: `grep "AnimatedPayout" apps/portal/src/components/calculator/tier-comparison.tsx`
3. Has three tier columns: `grep "grid-cols-3" apps/portal/src/components/calculator/tier-comparison.tsx`
4. Build check: `pnpm --filter @splits-network/portal build` passes
   </verify>
   <done>
   TierComparison displays three columns for Free, Paid, and Premium tiers with animated payouts. Pro tier is visually highlighted. Upgrade value badges show dollar difference vs Starter. ROI summary helps recruiters understand upgrade value.
   </done>
   </task>

<task type="auto">
  <name>Task 3: Update barrel export to include new components</name>
  <files>apps/portal/src/components/calculator/index.ts</files>
  <action>
Update the barrel export file to include the new components.

Add these exports to the existing index.ts:

```typescript
export * from "./animated-payout";
export * from "./tier-comparison";
```

Final index.ts should have:

```typescript
export * from "./types";
export * from "./commission-rates";
export * from "./use-calculator";
export * from "./fee-input";
export * from "./role-selector";
export * from "./animated-payout";
export * from "./tier-comparison";
```

  </action>
  <verify>
1. File updated: `cat apps/portal/src/components/calculator/index.ts`
2. Has tier-comparison export: `grep "tier-comparison" apps/portal/src/components/calculator/index.ts`
3. Has animated-payout export: `grep "animated-payout" apps/portal/src/components/calculator/index.ts`
4. Build check: `pnpm --filter @splits-network/portal build` passes
  </verify>
  <done>
Barrel export file includes AnimatedPayout and TierComparison components. All calculator components can be imported from '@/components/calculator'.
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @splits-network/portal build` completes without errors
2. AnimatedPayout uses GSAP for smooth number counting
3. AnimatedPayout respects prefers-reduced-motion
4. TierComparison shows three columns (Free, Paid, Premium)
5. Paid tier is visually emphasized (primary background, slight scale)
6. Upgrade value badges show dollar difference vs Starter
7. ROI summary calculates upgrade payback percentage
8. All components export from index.ts
</verification>

<success_criteria>

- AnimatedPayout uses gsap.to() with duration.counter (1.5s) to animate numbers
- AnimatedPayout checks prefers-reduced-motion and skips animation if enabled
- AnimatedPayout cleans up animations on unmount (animationRef.current.kill())
- TierComparison displays 3 tier cards in grid (md:grid-cols-3)
- Pro tier card has bg-primary and scale-[1.02] for emphasis
- Premium tier card has border-2 border-yellow
- Upgrade value badges show "+$X" with badge-success styling
- ROI summary shows "One placement pays for your upgrade" message
- Breakdown details table shows payout and platform take per tier
- Build passes with no TypeScript errors
  </success_criteria>

<output>
After completion, create `.planning/phases/03-rti-calculator/03-02-SUMMARY.md`
</output>
