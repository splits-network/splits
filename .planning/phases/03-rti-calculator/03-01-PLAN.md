---
phase: 03-rti-calculator
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/portal/src/components/calculator/types.ts
  - apps/portal/src/components/calculator/commission-rates.ts
  - apps/portal/src/components/calculator/use-calculator.ts
  - apps/portal/src/components/calculator/fee-input.tsx
  - apps/portal/src/components/calculator/role-selector.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter a placement fee amount directly in dollars"
    - "User can toggle to salary + fee percentage mode and enter both values"
    - "User can select multiple recruiter roles via checkboxes"
    - "Calculator state updates reactively when inputs change"
  artifacts:
    - path: "apps/portal/src/components/calculator/types.ts"
      provides: "TypeScript types for calculator state, roles, and commission rates"
      exports: ["RecruiterRole", "CommissionRates", "CalculatorState", "TierPayout"]
    - path: "apps/portal/src/components/calculator/commission-rates.ts"
      provides: "Commission rate constants by tier and role"
      exports: ["COMMISSION_RATES", "TIER_NAMES"]
    - path: "apps/portal/src/components/calculator/use-calculator.ts"
      provides: "React hook managing calculator state and payout calculations"
      exports: ["useCalculator"]
    - path: "apps/portal/src/components/calculator/fee-input.tsx"
      provides: "Fee input component with toggle between direct fee and salary mode"
      exports: ["FeeInput"]
    - path: "apps/portal/src/components/calculator/role-selector.tsx"
      provides: "Multi-select checkbox component for recruiter roles"
      exports: ["RoleSelector"]
  key_links:
    - from: "use-calculator.ts"
      to: "commission-rates.ts"
      via: "imports COMMISSION_RATES for payout calculations"
      pattern: "import.*COMMISSION_RATES"
    - from: "fee-input.tsx"
      to: "types.ts"
      via: "imports CalculatorState type"
      pattern: "import.*CalculatorState"
---

<objective>
Create the calculator data model, commission rate constants, and input components (fee input and role selector).

Purpose: Establish the foundation for the RTI calculator - the data model that calculates payouts and the input components that collect user data. This wave has no dependencies and can run parallel with other Phase 3 work.
Output: TypeScript types, commission rate constants, useCalculator hook, FeeInput component, RoleSelector component.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@apps/portal/src/components/landing/shared/animation-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create calculator types and commission rate constants</name>
  <files>
    apps/portal/src/components/calculator/types.ts
    apps/portal/src/components/calculator/commission-rates.ts
  </files>
  <action>
Create the TypeScript types and commission rate constants for the calculator.

**types.ts:**
```typescript
export type RecruiterRole =
  | 'candidate_recruiter'
  | 'job_owner'
  | 'company_recruiter'
  | 'candidate_sourcer'
  | 'company_sourcer';

export type Tier = 'free' | 'paid' | 'premium';

export interface CommissionRates {
  candidate_recruiter: number;
  job_owner: number;
  company_recruiter: number;
  candidate_sourcer: number;
  company_sourcer: number;
}

export interface TierPayout {
  tier: Tier;
  tierName: string;
  monthlyPrice: number;
  payout: number;
  platformTake: number;
}

export interface CalculatorState {
  // Input mode
  inputMode: 'fee' | 'salary';
  // Direct fee input
  placementFee: number;
  // Salary mode inputs
  salary: number;
  feePercentage: number;
  // Selected roles
  selectedRoles: RecruiterRole[];
}

export interface RoleMeta {
  id: RecruiterRole;
  label: string;
  description: string;
}
```

**commission-rates.ts:**
```typescript
import { CommissionRates, Tier, RoleMeta } from './types';

// Commission rates by tier (percentage of placement fee going to recruiter for each role)
// From PROJECT.md commission structure
export const COMMISSION_RATES: Record<Tier, CommissionRates> = {
  free: {
    candidate_recruiter: 0.20,
    job_owner: 0.10,
    company_recruiter: 0.10,
    candidate_sourcer: 0.06,
    company_sourcer: 0.06,
  },
  paid: {
    candidate_recruiter: 0.30,
    job_owner: 0.15,
    company_recruiter: 0.15,
    candidate_sourcer: 0.08,
    company_sourcer: 0.08,
  },
  premium: {
    candidate_recruiter: 0.40,
    job_owner: 0.20,
    company_recruiter: 0.20,
    candidate_sourcer: 0.10,
    company_sourcer: 0.10,
  },
};

// Platform take percentages by tier
export const PLATFORM_TAKE: Record<Tier, number> = {
  free: 0.48,
  paid: 0.24,
  premium: 0.00,
};

// Tier display names and monthly prices
export const TIER_INFO: Record<Tier, { name: string; monthlyPrice: number }> = {
  free: { name: 'Starter', monthlyPrice: 0 },
  paid: { name: 'Pro', monthlyPrice: 99 },
  premium: { name: 'Partner', monthlyPrice: 249 },
};

// Role metadata for UI display
export const ROLE_META: RoleMeta[] = [
  {
    id: 'candidate_recruiter',
    label: 'Candidate Recruiter',
    description: 'Found and represents the candidate',
  },
  {
    id: 'job_owner',
    label: 'Job Owner',
    description: 'Owns the job requisition relationship',
  },
  {
    id: 'company_recruiter',
    label: 'Company Recruiter',
    description: 'Sourced and manages company relationship',
  },
  {
    id: 'candidate_sourcer',
    label: 'Candidate Sourcer',
    description: 'Initially sourced the candidate',
  },
  {
    id: 'company_sourcer',
    label: 'Company Sourcer',
    description: 'Initially sourced the company',
  },
];
```
  </action>
  <verify>
1. Check types file exists: `ls apps/portal/src/components/calculator/types.ts`
2. Check commission rates file exists: `ls apps/portal/src/components/calculator/commission-rates.ts`
3. TypeScript compilation: `pnpm --filter @splits-network/portal build` passes
  </verify>
  <done>
TypeScript types define RecruiterRole, Tier, CommissionRates, TierPayout, CalculatorState, and RoleMeta. Commission rates match PROJECT.md specification (Free: 20/10/10/6/6, Paid: 30/15/15/8/8, Premium: 40/20/20/10/10).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useCalculator hook with payout calculation logic</name>
  <files>apps/portal/src/components/calculator/use-calculator.ts</files>
  <action>
Create a React hook that manages calculator state and computes payouts for all three tiers.

```typescript
'use client';

import { useState, useMemo } from 'react';
import { CalculatorState, TierPayout, RecruiterRole, Tier } from './types';
import { COMMISSION_RATES, PLATFORM_TAKE, TIER_INFO } from './commission-rates';

const TIERS: Tier[] = ['free', 'paid', 'premium'];

const DEFAULT_STATE: CalculatorState = {
  inputMode: 'fee',
  placementFee: 20000, // Default $20k placement fee
  salary: 100000,      // Default $100k salary
  feePercentage: 20,   // Default 20% fee
  selectedRoles: ['candidate_recruiter'], // Default to most common role
};

export function useCalculator(initialState?: Partial<CalculatorState>) {
  const [state, setState] = useState<CalculatorState>({
    ...DEFAULT_STATE,
    ...initialState,
  });

  // Calculate effective placement fee based on input mode
  const effectiveFee = useMemo(() => {
    if (state.inputMode === 'fee') {
      return state.placementFee;
    }
    return (state.salary * state.feePercentage) / 100;
  }, [state.inputMode, state.placementFee, state.salary, state.feePercentage]);

  // Calculate payout for a given tier based on selected roles
  const calculateTierPayout = (tier: Tier): number => {
    if (state.selectedRoles.length === 0) return 0;

    const rates = COMMISSION_RATES[tier];
    const totalRate = state.selectedRoles.reduce((sum, role) => {
      return sum + rates[role];
    }, 0);

    return effectiveFee * totalRate;
  };

  // Calculate payouts for all tiers
  const payouts = useMemo((): TierPayout[] => {
    return TIERS.map((tier) => ({
      tier,
      tierName: TIER_INFO[tier].name,
      monthlyPrice: TIER_INFO[tier].monthlyPrice,
      payout: calculateTierPayout(tier),
      platformTake: effectiveFee * PLATFORM_TAKE[tier],
    }));
  }, [effectiveFee, state.selectedRoles]);

  // Calculate upgrade value (difference between paid/premium and free)
  const upgradeValue = useMemo(() => {
    const freePayout = payouts.find(p => p.tier === 'free')?.payout ?? 0;
    const paidPayout = payouts.find(p => p.tier === 'paid')?.payout ?? 0;
    const premiumPayout = payouts.find(p => p.tier === 'premium')?.payout ?? 0;

    return {
      paidVsFree: paidPayout - freePayout,
      premiumVsFree: premiumPayout - freePayout,
      premiumVsPaid: premiumPayout - paidPayout,
    };
  }, [payouts]);

  // State update functions
  const setInputMode = (mode: 'fee' | 'salary') => {
    setState(prev => ({ ...prev, inputMode: mode }));
  };

  const setPlacementFee = (fee: number) => {
    setState(prev => ({ ...prev, placementFee: Math.max(0, fee) }));
  };

  const setSalary = (salary: number) => {
    setState(prev => ({ ...prev, salary: Math.max(0, salary) }));
  };

  const setFeePercentage = (percentage: number) => {
    setState(prev => ({ ...prev, feePercentage: Math.min(100, Math.max(0, percentage)) }));
  };

  const toggleRole = (role: RecruiterRole) => {
    setState(prev => {
      const isSelected = prev.selectedRoles.includes(role);
      const newRoles = isSelected
        ? prev.selectedRoles.filter(r => r !== role)
        : [...prev.selectedRoles, role];
      return { ...prev, selectedRoles: newRoles };
    });
  };

  const setSelectedRoles = (roles: RecruiterRole[]) => {
    setState(prev => ({ ...prev, selectedRoles: roles }));
  };

  return {
    state,
    effectiveFee,
    payouts,
    upgradeValue,
    setInputMode,
    setPlacementFee,
    setSalary,
    setFeePercentage,
    toggleRole,
    setSelectedRoles,
  };
}
```
  </action>
  <verify>
1. File exists: `ls apps/portal/src/components/calculator/use-calculator.ts`
2. TypeScript compilation: `pnpm --filter @splits-network/portal build` passes
3. Verify hook exports: grep for `export function useCalculator`
  </verify>
  <done>
useCalculator hook manages all calculator state (input mode, fee/salary, selected roles) and computes payouts for all three tiers. Includes upgradeValue calculation for highlighting tier differences.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create FeeInput and RoleSelector components</name>
  <files>
    apps/portal/src/components/calculator/fee-input.tsx
    apps/portal/src/components/calculator/role-selector.tsx
    apps/portal/src/components/calculator/index.ts
  </files>
  <action>
Create the input components for the calculator.

**fee-input.tsx:**
```typescript
'use client';

import { useId } from 'react';

interface FeeInputProps {
  inputMode: 'fee' | 'salary';
  placementFee: number;
  salary: number;
  feePercentage: number;
  effectiveFee: number;
  onInputModeChange: (mode: 'fee' | 'salary') => void;
  onPlacementFeeChange: (fee: number) => void;
  onSalaryChange: (salary: number) => void;
  onFeePercentageChange: (percentage: number) => void;
}

export function FeeInput({
  inputMode,
  placementFee,
  salary,
  feePercentage,
  effectiveFee,
  onInputModeChange,
  onPlacementFeeChange,
  onSalaryChange,
  onFeePercentageChange,
}: FeeInputProps) {
  const feeId = useId();
  const salaryId = useId();
  const percentageId = useId();

  const formatCurrency = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(value);
  };

  return (
    <div className="space-y-4">
      {/* Mode Toggle */}
      <div className="flex gap-2">
        <button
          type="button"
          className={`btn btn-sm ${inputMode === 'fee' ? 'btn-primary' : 'btn-ghost'}`}
          onClick={() => onInputModeChange('fee')}
        >
          Direct Fee
        </button>
        <button
          type="button"
          className={`btn btn-sm ${inputMode === 'salary' ? 'btn-primary' : 'btn-ghost'}`}
          onClick={() => onInputModeChange('salary')}
        >
          Salary + %
        </button>
      </div>

      {inputMode === 'fee' ? (
        /* Direct Fee Input */
        <fieldset className="form-control">
          <label htmlFor={feeId} className="label">
            <span className="label-text font-medium">Placement Fee</span>
          </label>
          <label className="input input-bordered flex items-center gap-2">
            <span className="text-base-content/60">$</span>
            <input
              id={feeId}
              type="number"
              className="grow"
              placeholder="20000"
              value={placementFee || ''}
              onChange={(e) => onPlacementFeeChange(Number(e.target.value))}
              min={0}
              step={1000}
            />
          </label>
        </fieldset>
      ) : (
        /* Salary + Percentage Inputs */
        <div className="grid grid-cols-2 gap-4">
          <fieldset className="form-control">
            <label htmlFor={salaryId} className="label">
              <span className="label-text font-medium">Annual Salary</span>
            </label>
            <label className="input input-bordered flex items-center gap-2">
              <span className="text-base-content/60">$</span>
              <input
                id={salaryId}
                type="number"
                className="grow"
                placeholder="100000"
                value={salary || ''}
                onChange={(e) => onSalaryChange(Number(e.target.value))}
                min={0}
                step={5000}
              />
            </label>
          </fieldset>
          <fieldset className="form-control">
            <label htmlFor={percentageId} className="label">
              <span className="label-text font-medium">Fee %</span>
            </label>
            <label className="input input-bordered flex items-center gap-2">
              <input
                id={percentageId}
                type="number"
                className="grow"
                placeholder="20"
                value={feePercentage || ''}
                onChange={(e) => onFeePercentageChange(Number(e.target.value))}
                min={0}
                max={100}
                step={1}
              />
              <span className="text-base-content/60">%</span>
            </label>
          </fieldset>
        </div>
      )}

      {/* Calculated Fee Display (salary mode only) */}
      {inputMode === 'salary' && (
        <div className="text-sm text-base-content/70">
          Placement Fee: <span className="font-semibold">{formatCurrency(effectiveFee)}</span>
        </div>
      )}
    </div>
  );
}
```

**role-selector.tsx:**
```typescript
'use client';

import { RecruiterRole } from './types';
import { ROLE_META } from './commission-rates';

interface RoleSelectorProps {
  selectedRoles: RecruiterRole[];
  onToggleRole: (role: RecruiterRole) => void;
}

export function RoleSelector({ selectedRoles, onToggleRole }: RoleSelectorProps) {
  return (
    <div className="space-y-3">
      <div className="font-medium text-base-content">Your Role(s) in the Deal</div>
      <div className="text-sm text-base-content/70 mb-2">
        Select all roles you hold in this placement
      </div>
      <div className="grid gap-2">
        {ROLE_META.map((role) => {
          const isSelected = selectedRoles.includes(role.id);
          return (
            <label
              key={role.id}
              className={`flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-colors ${
                isSelected
                  ? 'bg-primary/10 border-2 border-primary'
                  : 'bg-base-200 border-2 border-transparent hover:bg-base-300'
              }`}
            >
              <input
                type="checkbox"
                className="checkbox checkbox-primary mt-0.5"
                checked={isSelected}
                onChange={() => onToggleRole(role.id)}
              />
              <div>
                <div className="font-medium">{role.label}</div>
                <div className="text-sm text-base-content/60">{role.description}</div>
              </div>
            </label>
          );
        })}
      </div>
      {selectedRoles.length === 0 && (
        <div className="text-sm text-warning">
          <i className="fa-duotone fa-regular fa-triangle-exclamation mr-1"></i>
          Select at least one role to see your payout
        </div>
      )}
    </div>
  );
}
```

**index.ts (barrel export):**
```typescript
export * from './types';
export * from './commission-rates';
export * from './use-calculator';
export * from './fee-input';
export * from './role-selector';
```
  </action>
  <verify>
1. Files exist: `ls apps/portal/src/components/calculator/*.tsx`
2. Index exports: `cat apps/portal/src/components/calculator/index.ts`
3. Build check: `pnpm --filter @splits-network/portal build` passes
  </verify>
  <done>
FeeInput component allows toggle between direct fee and salary+% modes with proper DaisyUI styling. RoleSelector component displays all 5 roles with checkbox selection and descriptions. Both components use proper form patterns per guidance docs.
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @splits-network/portal build` completes without TypeScript errors
2. All 5 files created in apps/portal/src/components/calculator/
3. types.ts exports all required types
4. commission-rates.ts has correct percentages matching PROJECT.md
5. useCalculator hook computes payouts correctly for all tiers
6. FeeInput supports both input modes
7. RoleSelector shows all 5 roles with checkboxes
</verification>

<success_criteria>
- types.ts defines RecruiterRole (5 roles), Tier (3 tiers), CommissionRates, TierPayout, CalculatorState
- commission-rates.ts has COMMISSION_RATES matching PROJECT.md (Free: 20/10/10/6/6%, Paid: 30/15/15/8/8%, Premium: 40/20/20/10/10%)
- useCalculator hook returns state, effectiveFee, payouts array (3 tiers), upgradeValue, and setter functions
- FeeInput has toggle between 'fee' and 'salary' modes, shows calculated fee in salary mode
- RoleSelector displays 5 roles with checkbox selection and role descriptions
- All components use DaisyUI classes (btn, input, checkbox, etc.)
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-rti-calculator/03-01-SUMMARY.md`
</output>
