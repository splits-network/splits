---
phase: 01-animation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
    - apps/portal/src/app/pricing/page.tsx
autonomous: true

must_haves:
    truths:
        - "Pricing page loads without errors"
        - "GSAP and ScrollTrigger initialize on page mount"
        - "Hero section fades in with animation on scroll"
        - "Animation respects prefers-reduced-motion"
    artifacts:
        - path: "apps/portal/src/app/pricing/page.tsx"
          provides: "Animated pricing page with GSAP integration"
          contains: "'use client'"
    key_links:
        - from: "apps/portal/src/app/pricing/page.tsx"
          to: "apps/portal/src/components/landing/shared/animation-utils.ts"
          via: "import statement"
          pattern: "from.*animation-utils"
        - from: "apps/portal/src/app/pricing/page.tsx"
          to: "gsap/ScrollTrigger"
          via: "gsap.registerPlugin"
          pattern: "gsap\\.registerPlugin\\(ScrollTrigger\\)"
---

<objective>
Set up GSAP animation infrastructure on the pricing page, proving the animation utilities work outside the landing page.

Purpose: Establish the foundation for Phase 2 visual redesign by confirming GSAP/ScrollTrigger work correctly on the pricing page and that landing page animation utilities are importable and functional.

Output: A working pricing page with GSAP initialized and at least one scroll-triggered animation on the hero section.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Reference implementation (follow this pattern exactly):
@apps/portal/src/components/landing/sections/features-section.tsx

Animation utilities to import:
@apps/portal/src/components/landing/shared/animation-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert pricing page to client component with GSAP setup</name>
  <files>apps/portal/src/app/pricing/page.tsx</files>
  <action>
Convert the static pricing page to use GSAP animations by following the features-section.tsx pattern:

1. Add 'use client' directive at the top of the file
2. Add imports:
    - `import { useRef } from 'react'`
    - `import gsap from 'gsap'`
    - `import { ScrollTrigger } from 'gsap/ScrollTrigger'`
    - `import { useGSAP } from '@gsap/react'`
    - `import { duration, easing } from '@/components/landing/shared/animation-utils'`

3. Register ScrollTrigger plugin (must be inside typeof window check):

    ```typescript
    if (typeof window !== "undefined") {
        gsap.registerPlugin(ScrollTrigger);
    }
    ```

4. Move metadata export to a separate file since client components cannot export metadata. Create `apps/portal/src/app/pricing/metadata.ts` with the metadata export, then import and re-export from a layout or use generateMetadata in a server component wrapper.

    ALTERNATIVE (simpler): Since this is a public page, create a thin server component wrapper:
    - Rename current page.tsx to pricing-content.tsx (client component with animations)
    - Create new page.tsx (server component) that exports metadata and renders PricingContent

5. In the client component (PricingContent):
    - Add a ref for the hero section: `const heroRef = useRef<HTMLElement>(null)`
    - Add a ref for the hero content: `const heroContentRef = useRef<HTMLDivElement>(null)`

6. Add useGSAP hook that:
    - Checks for prefers-reduced-motion and returns early if true
    - Animates the hero heading and paragraph with fadeUp effect
    - Uses ScrollTrigger with standard trigger settings

Pattern from features-section.tsx to follow:

```typescript
useGSAP(
    () => {
        if (!heroRef.current) return;

        const prefersReducedMotion = window.matchMedia(
            "(prefers-reduced-motion: reduce)",
        ).matches;
        if (prefersReducedMotion) return;

        gsap.fromTo(
            heroContentRef.current,
            { opacity: 0, y: 30 },
            {
                opacity: 1,
                y: 0,
                duration: duration.normal,
                ease: easing.smooth,
                scrollTrigger: {
                    trigger: heroRef.current,
                    start: "top 80%",
                },
            },
        );
    },
    { scope: heroRef },
);
```

7. Update hero section JSX:
    - Add ref={heroRef} to the hero section element
    - Add ref={heroContentRef} to the hero-content div
    - Add opacity-0 class to hero-content div (initial state before animation)
      </action>
      <verify>
      Run `pnpm --filter @splits-network/portal build` - should complete without errors.
      Run `pnpm --filter @splits-network/portal dev` and visit http://localhost:3100/pricing - page should load and hero should animate in.
      </verify>
      <done>

- Pricing page renders without errors
- 'use client' directive present
- GSAP and ScrollTrigger imports present
- animation-utils imported from landing shared folder
- gsap.registerPlugin(ScrollTrigger) called
- useGSAP hook present with scroll-triggered animation
- Hero content animates on page load (fades up)
  </done>
  </task>

<task type="auto">
  <name>Task 2: Verify animation works and respects reduced motion</name>
  <files>apps/portal/src/app/pricing/page.tsx</files>
  <action>
Test and verify the animation setup:

1. Start dev server: `pnpm --filter @splits-network/portal dev`
2. Visit http://localhost:3100/pricing
3. Scroll up/down - hero should animate in when scrolling into view
4. Open browser DevTools, go to Rendering tab, enable "Emulate CSS media feature prefers-reduced-motion: reduce"
5. Refresh page - hero should appear immediately without animation

If animation does not work:

- Check browser console for errors
- Verify GSAP is registered before component mounts
- Ensure refs are attached to correct elements
- Check that opacity-0 class is on the animated element

If reduced motion check fails:

- Verify the prefersReducedMotion check runs before gsap.fromTo
- Ensure early return happens when reduce motion is preferred
  </action>
  <verify>
- `pnpm --filter @splits-network/portal build` passes
- No console errors on /pricing page
- Hero animates on normal scroll
- Hero appears instantly with prefers-reduced-motion enabled
  </verify>
  <done>
- Animation visually works (hero fades up on scroll)
- Reduced motion preference respected (no animation when enabled)
- No console errors or warnings related to GSAP
- Build completes successfully
  </done>
  </task>

</tasks>

<verification>
Phase verification checks:

1. **Import chain works**: Pricing page successfully imports from `@/components/landing/shared/animation-utils`
2. **GSAP initializes**: No runtime errors, ScrollTrigger registered
3. **Animation fires**: Hero section animates on scroll into view
4. **Accessibility**: Animation disabled when prefers-reduced-motion is set
5. **Build passes**: `pnpm --filter @splits-network/portal build` succeeds
   </verification>

<success_criteria>

- [ ] Pricing page is a client component with 'use client'
- [ ] Imports GSAP, ScrollTrigger, useGSAP from correct packages
- [ ] Imports animation utilities from landing page shared folder
- [ ] gsap.registerPlugin(ScrollTrigger) called
- [ ] At least one element (hero) has scroll-triggered animation
- [ ] Animation respects prefers-reduced-motion
- [ ] Page builds and runs without errors
      </success_criteria>

<output>
After completion, create `.planning/phases/01-animation-infrastructure/01-01-SUMMARY.md`
</output>
