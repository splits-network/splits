apiVersion: batch/v1
kind: Job
metadata:
    name: ats-backfill-guarantee-expires
    namespace: splits-network
    labels:
        app: ats-service
        component: job
spec:
    backoffLimit: 0
    template:
        metadata:
            labels:
                app: ats-service
                component: job
        spec:
            restartPolicy: Never
            containers:
                - name: ats-backfill-guarantee-expires
                  image: ${ACR_SERVER}/ats-service:${IMAGE_TAG}
                  imagePullPolicy: Always
                  command: ["node"]
                  args:
                      [
                          "services/ats-service/dist/jobs/backfill-guarantee-expires.js",
                      ]
                  env:
                      - name: SUPABASE_URL
                        valueFrom:
                            secretKeyRef:
                                name: supabase-secrets
                                key: supabase-url
                      - name: SUPABASE_SERVICE_ROLE_KEY
                        valueFrom:
                            secretKeyRef:
                                name: supabase-secrets
                                key: supabase-service-role-key
                      - name: NODE_ENV
                        value: "production"
                      - name: LOG_LEVEL
                        value: "info"
